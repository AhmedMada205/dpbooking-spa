<div class="dashboard-wrapper">
  <!-- Top Navigation Bar -->
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="logo">
        <img src="assets/booking.png" alt="dpBooking Logo" class="logo-image" />
      </div>
      <div class="nav-toggle" (click)="toggleSidebar()">
        <i class="toggle-icon">โฐ</i>
      </div>
    </div>

    <div class="navbar-actions">
      <!-- User Profile -->
      <div class="user-profile" (click)="toggleUserMenu()">
        <div class="user-avatar">
          <i class="avatar-icon">๐ค</i>
        </div>
        <div class="user-info">
          <span class="user-name">{{ userName }}</span>
          <span class="user-role">{{ userRole }}</span>
        </div>
        <i class="dropdown-icon">โผ</i>

        <!-- User Dropdown Menu -->
        <div class="user-dropdown" [class.show]="showUserMenu">
          <a class="dropdown-item" (click)="viewProfile()">
            <i class="item-icon">๐ค</i>
            <span>ุงูููู ุงูุดุฎุตู</span>
          </a>
          <a class="dropdown-item" (click)="changePassword()">
            <i class="item-icon">๐</i>
            <span>ุชุบููุฑ ูููุฉ ุงููุฑูุฑ</span>
          </a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item logout" (click)="logout()">
            <i class="item-icon">๐ช</i>
            <span>ุชุณุฌูู ุงูุฎุฑูุฌ</span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Sidebar (Collapsible) -->
    <aside class="sidebar" [class.collapsed]="sidebarCollapsed">
      <div class="sidebar-menu">
        <a class="menu-item active" (click)="navigateTo('dashboard')">
          <i class="menu-icon">๐</i>
          <span class="menu-text" *ngIf="!sidebarCollapsed">ููุญุฉ ุงูุชุญูู</span>
        </a>

        <div class="menu-section" *ngIf="!sidebarCollapsed">
          <span class="section-title">ุงูุญุฌูุฒุงุช</span>
        </div>
        <a class="menu-item" (click)="navigateTo('bookings')">
          <i class="menu-icon">๐</i>
          <span class="menu-text" *ngIf="!sidebarCollapsed">ุฌููุน ุงูุญุฌูุฒุงุช</span>
        </a>
        <a class="menu-item" (click)="navigateTo('/bookings/new')">
          <i class="menu-icon">โ</i>
          <span class="menu-text" *ngIf="!sidebarCollapsed">ุญุฌุฒ ุฌุฏูุฏ</span>
        </a>
        <a class="menu-item" (click)="navigateTo('calendar')">
          <i class="menu-icon">๐</i>
          <span class="menu-text" *ngIf="!sidebarCollapsed">ุงูุชูููู</span>
        </a>

        <div class="menu-section" *ngIf="!sidebarCollapsed">
          <span class="section-title">ุงูุชูุงุฑูุฑ</span>
        </div>
        <a class="menu-item" (click)="navigateTo('bookings/print')">
          <i class="menu-icon">๐</i>
          <span class="menu-text" *ngIf="!sidebarCollapsed">ุงูุชูุงุฑูุฑ</span>
        </a>
        <a class="menu-item" (click)="navigateTo('analytics')">
          <i class="menu-icon">๐</i>
          <span class="menu-text" *ngIf="!sidebarCollapsed">ุงูุชุญูููุงุช</span>
        </a>

        <div class="menu-section" *ngIf="!sidebarCollapsed">
          <span class="section-title">ุงูุฅุนุฏุงุฏุงุช</span>
        </div>
        <a class="menu-item" (click)="navigateTo('settings')">
          <i class="menu-icon">โ๏ธ</i>
          <span class="menu-text" *ngIf="!sidebarCollapsed">ุงูุฅุนุฏุงุฏุงุช</span>
        </a>
        <a class="menu-item" (click)="navigateTo('users')" *ngIf="isAdmin">
          <i class="menu-icon">๐ฅ</i>
          <span class="menu-text" *ngIf="!sidebarCollapsed">ุงููุณุชุฎุฏููู</span>
        </a>
      </div>

      <div class="sidebar-footer" *ngIf="!sidebarCollapsed">
        <div class="sidebar-logo">
          <img src="assets/booking.png" alt="dpBooking" class="footer-logo" />
          <span class="logo-name">dpBooking</span>
        </div>
        <div class="system-status">
          <div class="status-indicator online"></div>
          <span>ุงููุธุงู ูุชุตู</span>
        </div>
        <div class="version">ุงูุฅุตุฏุงุฑ 2.0.1</div>
      </div>
    </aside>

    <!-- Content Area -->
    <div class="content-area">
      <!-- Welcome Section -->
      <div class="welcome-card">
        <div class="welcome-inner">
          <div class="welcome-content">
            <h1 class="welcome-title">ูุฑุญุจุงู {{ userName }} ๐</h1>
            <span class="role-badge">
              {{ userRole }}
            </span>
            <p class="welcome-message">
              ุฅุฏุงุฑุฉ ุญุฌูุฒุงุช ุฑูุถุงู - ุงูููู {{ currentDate | date: "dd MMMM" }}
            </p>
          </div>

          <div class="welcome-actions">
            <button class="primary-btn" (click)="createBooking()">
              <i class="btn-icon">โ</i>
              <span>ุญุฌุฒ ุฌุฏูุฏ</span>
            </button>

            <button
              class="secondary-btn iftar-btn"
              (click)="printStationReport(5, 'ุฅูุทุงุฑ ุฑูุถุงู')"
              title="ุทุจุงุนุฉ ุชูุฑูุฑ ูุญุทุงุช ุงูุฅูุทุงุฑ"
            >
              <i class="btn-icon">๐</i>
              <span>ุชูุฑูุฑ ุงูุฅูุทุงุฑ ุงููููู</span>
            </button>

            <button
              class="secondary-btn suhur-btn"
              (click)="printStationReport(6, 'ุณุญูุฑ ุฑูุถุงู')"
              title="ุทุจุงุนุฉ ุชูุฑูุฑ ูุญุทุงุช ุงูุณุญูุฑ"
            >
              <i class="btn-icon">๐</i>
              <span>ุชูุฑูุฑ ุงูุณุญูุฑ ุงููููู</span>
            </button>

            <button
              class="secondary-btn full-report-btn"
              (click)="printFullDayReport()"
              [disabled]="bookings.length === 0"
            >
              <i class="btn-icon">๐</i>
              <span>ุชูุฑูุฑ ุงูููู ุงููุงูู</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-content">
            <div class="stat-icon total-bookings">
              <i>๐</i>
            </div>
            <div class="stat-info">
              <span class="stat-value">{{ todayStats.totalBookings }}</span>
              <span class="stat-label">ุฅุฌูุงูู ุงูุญุฌูุฒุงุช</span>
            </div>
          </div>
          <div class="stat-trend" *ngIf="todayStats.trend > 0">
            <span>+{{ todayStats.trend }}%</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-content">
            <div class="stat-icon revenue">
              <i>๐ฐ</i>
            </div>
            <div class="stat-info">
              <span class="stat-value">{{
                todayStats.revenue | currency: "EGP" : "symbol" : "1.0-0"
              }}</span>
              <span class="stat-label">ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช</span>
            </div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-content">
            <div class="stat-icon active">
              <i>โ</i>
            </div>
            <div class="stat-info">
              <span class="stat-value">{{ todayStats.activeBookings }}</span>
              <span class="stat-label">ุญุฌูุฒุงุช ูุดุทุฉ</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Today's Bookings Table -->
      <div class="table-card">
        <!-- Header -->
        <div class="table-header">
          <h2 class="table-title">ุญุฌูุฒุงุช ุงูููู</h2>

          <div class="table-actions">
            <div class="date-navigation">
              <button class="nav-btn" (click)="previousDay()">
                โ ุงูููู ุงูุณุงุจู
              </button>

              <div class="date-card">
                <input
                  type="text"
                  class="form-control date-input"
                  bsDatepicker
                  [bsValue]="selectedDate"
                  (bsValueChange)="onDateChange($event)"
                  [bsConfig]="{
                    dateInputFormat: 'DD/MM/YYYY',
                    showWeekNumbers: false
                  }"
                  placeholder="ุงุฎุชุฑ ุงูุชุงุฑูุฎ"
                />
              </div>

              <button class="nav-btn" (click)="nextDay()">
                ุงูููู ุงูุชุงูู โถ
              </button>
            </div>

            <div class="table-controls">
              <button
                class="control-btn"
                (click)="refreshBookings()"
                title="ุชุญุฏูุซ"
              >
                ๐
              </button>
            </div>
          </div>
        </div>

        <!-- Loading -->
        <div class="loading-state" *ngIf="loading">
          <div class="loader"></div>
          <span>ุฌุงุฑู ุชุญููู ุงูุญุฌูุฒุงุช...</span>
        </div>

        <!-- Table Wrapper -->
        <div class="table-body-wrapper" *ngIf="!loading && bookings.length > 0">
          <table class="bookings-table">
            <thead>
              <tr>
                <th>#</th>
                <th>ุงูุนููู</th>
                <th>ุงููุงุชู</th>
                <th>ุงูููุน</th>
                <th>ุงูููุงู</th>
                <th>ุงูุฃุดุฎุงุต</th>
                <th>ุงูุชูููุช</th>
                <th>ุงููุจูุบ</th>
                <th>ุงูุญุงูุฉ</th>
                <th>ุงูุฅุฌุฑุงุกุงุช</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let booking of bookings; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ booking.clientName || booking.customerName }}</td>
                <td>
                  {{ booking.clientPhone || booking.phone1 }}
                  <span *ngIf="booking.clientMobile || booking.phone2">
                    / {{ booking.clientMobile || booking.phone2 }}
                  </span>
                </td>
                <td>
                  <span
                    class="booking-type-badge"
                    [ngClass]="getBookingTypeClass(booking.bookingType)"
                  >
                    {{ getBookingTypeText(booking.bookingType) }}
                  </span>
                </td>
                <td>{{ getVenueName(booking.venueId) }}</td>
                <td>{{ booking.guestsCount || booking.numberOfGuests }}</td>
                <td>
                  {{ formatTime(booking.bookingTime) }}
                  <span *ngIf="!isToday(booking.bookingDate)">
                    {{ booking.bookingDate | date: "dd/MM" }}
                  </span>
                </td>
                <td>
                  <div class="amount-cell">
                    <div>
                      {{
                        booking.totalAmount
                          | currency: "EGP" : "symbol" : "1.0-0"
                      }}
                    </div>
                    <div
                      class="payment-status"
                      [class.paid]="
                        (booking.depositAmount || 0) ===
                        (booking.totalAmount || 0)
                      "
                      [class.partial]="
                        (booking.depositAmount || 0) > 0 &&
                        (booking.depositAmount || 0) <
                          (booking.totalAmount || 0)
                      "
                    >
                      {{
                        booking.depositAmount || 0
                          | currency: "EGP" : "symbol" : "1.0-0"
                      }}
                      ูุฏููุน
                    </div>
                  </div>
                </td>
                <td>
                  <span
                    class="status-badge"
                    [ngClass]="getStatusClass(booking.bookingStatus)"
                  >
                    {{ getStatusText(booking.bookingStatus) }}
                  </span>
                </td>

                <td>
                  <button
                    class="simple-menu"
                    (click)="openMenu(booking, $event)"
                  >
                    โฐ
                  </button>
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Floating menu - ูุตุญุญ -->
          <div
            class="floating-menu"
            *ngIf="activeMenuBooking"
            [ngStyle]="{
              'top.px': menuPosition.top,
              'left.px': menuPosition.left
            }"
            (click)="$event.stopPropagation()"
          >
            <button
              *ngIf="
                activeMenuBooking.bookingStatus !== 3 &&
                activeMenuBooking.bookingStatus !== 5
              "
              (click)="editBooking(activeMenuBooking)"
            >
              โ๏ธ ุชุนุฏูู
            </button>
            <button (click)="print()">๐จ๏ธ ุทุจุงุนุฉ</button>
            <button
              *ngIf="activeMenuBooking.bookingStatus === 0"
              (click)="confirmBooking(activeMenuBooking)"
            >
              โ ุชุฃููุฏ
            </button>
            <button
              *ngIf="
                activeMenuBooking.bookingStatus === 0 ||
                activeMenuBooking.bookingStatus === 1
              "
              (click)="cancelBooking(activeMenuBooking)"
            >
              โ ุฅูุบุงุก
            </button>
          </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="!loading && bookings.length === 0">
          ๐ ูุง ุชูุฌุฏ ุญุฌูุฒุงุช ููุฐุง ุงูููู
          <button class="primary-btn" (click)="createBooking()">
            โ ุฅุถุงูุฉ ุญุฌุฒ ุฌุฏูุฏ
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification - ูุตุญุญ -->
  <div class="toast" [class.show]="showToast" [ngClass]="toastType">
    <i class="toast-icon">{{ toastIcon }}</i>
    <span class="toast-text">{{ toastMessage }}</span>
    <button class="toast-close" (click)="hideToast()">โ</button>
  </div>
</div>