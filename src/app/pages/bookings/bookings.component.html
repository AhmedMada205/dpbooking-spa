<div class="bookings-dashboard">
  <!-- Header Section -->
  <div class="dashboard-header mb-4">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h3 class="page-title mb-0">
          <i class="fa fa-calendar mr-2"></i>
          ุฅุฏุงุฑุฉ ุงูุญุฌูุฒุงุช
        </h3>
        <p class="text-muted mb-0 mt-1">
          ุนุฑุถ ูุชุนุฏูู ููุชุงุจุนุฉ ุฌููุน ุญุฌูุฒุงุช ุงููุทุนู
        </p>
      </div>
      
      <div class="header-actions">
        <button class="btn btn-primary btn-sm mr-2" (click)="createBooking()">
          <i class="fa fa-plus-circle mr-2"></i>
          ุฅูุดุงุก ุญุฌุฒ ุฌุฏูุฏ
        </button>
        
        <button class="btn btn-outline-secondary btn-sm mr-2" (click)="goToDashboard()">
          <i class="fa fa-arrow-left mr-1"></i> ุงูุนูุฏุฉ ููุฏุงุดุจูุฑุฏ
        </button>

        <!-- ูุงุฆูุฉ ุงูุทุจุงุนุฉ ุงูููุณุฏูุฉ -->
        <div class="btn-group dropdown" dropdown   container="body" >
          <button class="btn btn-success btn-sm dropdown-toggle" 
                  type="button"
                  id="printDropdown"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false">
            <i class="fa fa-print mr-2"></i>
            ุทุจุงุนุฉ ุงูุชูุงุฑูุฑ
          </button>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="printDropdown">
            <!-- <button class="dropdown-item" (click)="printOnlyBookings(5)">
              <i class="fa fa-print mr-2"></i>
              ุทุจุงุนุฉ ุงูุฅูุทุงุฑ (ุจุณูุท)
            </button> -->
            <div class="dropdown-divider"></div>
            <!-- <button class="dropdown-item" (click)="printSimpleReportByType(5)">
              <i class="fa fa-file-text-o mr-2"></i>
              ุทุจุงุนุฉ ุฅูุทุงุฑ (ูููุฐุฌ ุชูุฒูุน)
            </button>
            <button class="dropdown-item" (click)="printSimpleReportByType(6)">
              <i class="fa fa-file-text-o mr-2"></i>
              ุทุจุงุนุฉ ุณุญูุฑ (ูููุฐุฌ ุชูุฒูุน)
            </button> -->
            <div class="dropdown-divider"></div>
            <button class="dropdown-item" (click)="openPrintDialog()">
              <i class="fa fa-cog mr-2"></i>
              ุทุจุงุนุฉ ูุชูุฏูุฉ
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="row mb-4">
    <!-- ุฅุฌูุงูู ุงูุญุฌูุฒุงุช -->
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="card stat-card border-left-primary shadow-sm h-100">
        <div class="card-body py-3">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                ุฅุฌูุงูู ุงูุญุฌูุฒุงุช
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">{{ totalBookings }}</div>
            </div>
            <div class="col-auto">
              <i class="fa fa-calendar fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ุงูุญุฌูุฒุงุช ุงููุคูุฏุฉ -->
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="card stat-card border-left-success shadow-sm h-100">
        <div class="card-body py-3">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                ุงูุญุฌูุฒุงุช ุงููุคูุฏุฉ
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">{{ confirmedBookings }}</div>
            </div>
            <div class="col-auto">
              <i class="fa fa-check-circle fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ุงูุญุฌูุฒุงุช ุงูููุชุธุฑุฉ -->
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="card stat-card border-left-warning shadow-sm h-100">
        <div class="card-body py-3">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                ุงูุญุฌูุฒุงุช ุงูููุชุธุฑุฉ
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">{{ pendingBookings }}</div>
            </div>
            <div class="col-auto">
              <i class="fa fa-clock-o fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ุงูุญุฌูุฒุงุช ุงูููุบุงุฉ -->
    <div class="col-md-3 col-sm-6 mb-3">
      <div class="card stat-card border-left-danger shadow-sm h-100">
        <div class="card-body py-3">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                ุงูุญุฌูุฒุงุช ุงูููุบุงุฉ
              </div>
              <div class="h5 mb-0 font-weight-bold text-gray-800">{{ cancelledBookings }}</div>
            </div>
            <div class="col-auto">
              <i class="fa fa-times-circle fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters Section -->
<div class="card filters-card mb-4">
  <div class="card-body">
    <!-- ุนููุงู ุงูุจุทุงูุฉ -->
    <div class="card-header border-0 bg-transparent p-0 mb-4">
      <h5 class="card-title m-0 d-flex align-items-center">
        <span class="filter-icon">
          <i class="fa fa-sliders"></i>
        </span>
        <span class="text-gradient">ููุชุฑุฉ ุงูุญุฌูุฒุงุช</span>
        <span class="badge badge-count ms-2">{{filteredBookings.length}}</span>
      </h5>
      <small class="text-muted mt-1 d-block">ุงุณุชุฎุฏู ุฃุฏูุงุช ุงูููุชุฑุฉ ููุญุตูู ุนูู ูุชุงุฆุฌ ุฏูููุฉ</small>
    </div>

    <!-- ุตู ุงูููุงุชุฑ -->
    <div class="row filters-grid">
      <!-- ุญูู ุงูุจุญุซ -->
      <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="form-group">
          <label for="searchInput" class="form-label">
            <i class="fa fa-search me-1"></i>ุจุญุซ ุณุฑูุน
          </label>
          <div class="search-wrapper">
            <input type="text"
                   id="searchInput"
                   class="form-control search-input"
                   placeholder="ุงุจุญุซ ุจุงูุงุณูุ ุงููุงุชูุ ุงูุฑูู..."
                   [(ngModel)]="searchTerm"
                   (keyup.enter)="filterBookings()">
            <button class="search-btn" (click)="filterBookings()">
              <i class="fa fa-search"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- ููุชุฑ ุญุณุจ ุงูุญุงูุฉ -->
      <div class="col-xl-2 col-lg-3 col-md-6">
        <div class="form-group">
          <label for="statusFilter" class="form-label">
            <i class="fa fa-flag me-1"></i>ุงูุญุงูุฉ
          </label>
          <div class="select-wrapper">
            <select id="statusFilter"
                    class="form-select status-select"
                    [(ngModel)]="statusFilter"
                    (change)="filterBookings()">
              <option value="">ุฌููุน ุงูุญุงูุงุช</option>
              <option value="0" class="option-pending">โณ ููุฏ ุงูุงูุชุธุงุฑ</option>
              <option value="1" class="option-confirmed">โ ูุคูุฏ</option>
              <option value="2" class="option-cancelled">โ ููุบู</option>
              <option value="3" class="option-completed">โ ููุชูู</option>
              <option value="4" class="option-completed">โ ูุคุฌู</option>
            </select>
            <i class="fa fa-chevron-down select-arrow"></i>
          </div>
        </div>
      </div>

      <!-- ููุชุฑ ุญุณุจ ุงูููุน -->
      <div class="col-xl-2 col-lg-3 col-md-6">
        <div class="form-group">
          <label for="typeFilter" class="form-label">
            <i class="fa fa-tag me-1"></i>ููุน ุงูุญุฌุฒ
          </label>
          <div class="select-wrapper">
            <select id="typeFilter"
                    class="form-select type-select"
                    [(ngModel)]="typeFilter"
                    (change)="filterBookings()">
              <option value="">ุฌููุน ุงูุฃููุงุน</option>
              <option value="5" class="option-iftar">๐ ุฅูุทุงุฑ ุฑูุถุงู</option>
              <option value="6" class="option-suhur">๐ ุณุญูุฑ ุฑูุถุงู</option>
              <option value="1" class="option-wedding">๐ ุฒูุงู</option>
              <option value="2" class="option-ship">๐ข ุฑุญูุฉ ุจุญุฑูุฉ</option>
              <option value="3" class="option-engagement">๐ ุฎุทูุจุฉ</option>
              <option value="4" class="option-birthday">๐ ุนูุฏ ูููุงุฏ</option>
              <option value="7" class="option-garden">๐ณ ุญููุฉ ุญุฏููุฉ</option>
              <option value="8" class="option-conference">๐ ูุคุชูุฑ</option>
            </select>
            <i class="fa fa-chevron-down select-arrow"></i>
          </div>
        </div>
      </div>

      <!-- ููุชุฑ ุญุณุจ ุงูููุงู -->
      <div class="col-xl-2 col-lg-3 col-md-6">
        <div class="form-group">
          <label for="venueFilter" class="form-label">
            <i class="fa fa-map-marker-alt me-1"></i>ุงูููุงู
          </label>
          <div class="select-wrapper">
            <select id="venueFilter"
                    class="form-select venue-select"
                    [(ngModel)]="venueFilter"
                    (change)="filterBookings()">
              <option value="">ุฌููุน ุงูุฃูุงูู</option>
              <option *ngFor="let venue of venues" 
                      [value]="venue.venueId || venue.id"
                      class="option-venue">
                ๐ข {{ venue.venueName || venue.name }}
              </option>
            </select>
            <i class="fa fa-chevron-down select-arrow"></i>
          </div>
        </div>
      </div>
      <!-- ููุชุฑ ุญุณุจ ุชุงุฑูุฎ ูุญุฏุฏ -->
<div class="col-xl-2 col-lg-3 col-md-6">
  <div class="form-group">
    <label class="form-label">
      <i class="fa fa-calendar-check-o me-1"></i>ุชุงุฑูุฎ ูุญุฏุฏ
    </label>
    <input type="date"
           class="form-control"
           [(ngModel)]="dateOnly"
           (change)="filterBookings()">
  </div>
</div>

      <!-- ููุชุฑ ุญุณุจ ุงูุชุงุฑูุฎ -->
      <div class="col-xl-3 col-lg-6 col-md-12">
        <div class="form-group">
          <label class="form-label">
            <i class="fa fa-calendar-alt me-1"></i>ุงูุชุงุฑูุฎ
          </label>
          <div class="date-range-container">
            <div class="date-input-wrapper">
              <input type="date"
                     id="dateFrom"
                     class="form-control date-input"
                     [(ngModel)]="dateFrom"
                     (change)="filterBookings()">
              <label for="dateFrom" class="date-label">ูู</label>
            </div>
            <span class="date-separator">โ</span>
            <div class="date-input-wrapper">
              <input type="date"
                     id="dateTo"
                     class="form-control date-input"
                     [(ngModel)]="dateTo"
                     (change)="filterBookings()">
              <label for="dateTo" class="date-label">ุฅูู</label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ุฃุฒุฑุงุฑ ุงูุชุญูู -->
    <div class="actions-row mt-4 pt-3 border-top">
      <div class="d-flex justify-content-between align-items-center">
        <div class="results-info">
          <span class="text-muted me-3">
            <i class="fa fa-chart-bar me-1"></i>
            ุงููุชุงุฆุฌ: <strong>{{filteredBookings.length}}</strong> ูู <strong>{{bookings.length}}</strong>
          </span>
          <span class="badge badge-active-filters" *ngIf="hasActiveFilters()">
            {{countActiveFilters()}} ููุชุฑ ูุดุท
          </span>
        </div>
        
        <div class="actions-buttons">
          <button class="btn btn-clear-filters" (click)="clearFilters()">
            <i class="fa fa-times-circle me-1"></i>
            ูุณุญ ุงููู
            <span class="clear-badge" *ngIf="hasActiveFilters()">{{countActiveFilters()}}</span>
          </button>
          <button class="btn btn-apply-filters" (click)="filterBookings()">
            <i class="fa fa-filter me-1"></i>
            ุชุทุจูู ุงูููุชุฑ
          </button>
        </div>
      </div>
    </div>
  </div>
</div>


  <!-- Main Table -->
  <div class="card main-card border">
    <div class="card-header bg-light d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        <i class="fa fa-list mr-2"></i>ูุงุฆูุฉ ุงูุญุฌูุฒุงุช
      </h5>
      <div class="table-info">
        <span class="badge badge-light">{{ displayCount }}</span>
      </div>
    </div>
    
    <!-- Loading Indicator -->
    <div *ngIf="loading" class="text-center p-5">
      <div class="spinner-border text-primary" role="status">
        <span class="sr-only">ุฌุงุฑู ุงูุชุญููู...</span>
      </div>
      <p class="mt-2 text-muted">ุฌุงุฑู ุชุญููู ุงูุญุฌูุฒุงุช...</p>
    </div>
    
    <div *ngIf="!loading" class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="thead-light">
            <tr>
              <th width="60">#</th>
              <th width="150">ุงูุนููู</th>
              <th width="120">ุงูุชูุงุตู</th>
              <th width="80">ุนุฏุฏ ุงูุถููู</th>
              <th width="120">ุงูุชุงุฑูุฎ</th>
              <th width="100">ุงูููุช</th>
              <th width="120">ุงูููุงู</th>
              <th width="100">ุงูููุน</th>
              <th width="100">ุงูุญุงูุฉ</th>
              <th width="120">ุงููุจูุบ</th>
              <th width="100" class="text-center">ุงูุทุจุงุนุฉ</th>
              <th width="120" class="text-center">ุงูุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          
          <tbody>
            <tr *ngFor="let booking of paginatedBookings; let i = index">
              <!-- ุฑูู -->
              <td class="align-middle">
                <span class="badge badge-secondary">{{ (currentPage - 1) * itemsPerPage + i + 1 }}</span>
              </td>
              
              <!-- ุงูุนููู -->
              <td class="align-middle">
                <div class="client-info">
                  <strong class="d-block text-primary">{{ booking.clientName }}</strong>
                  <small class="text-muted">
                    <i class="fa fa-hashtag mr-1"></i>#{{ booking.bookingId }}
                  </small>
                </div>
              </td>
              
              <!-- ุงูุชูุงุตู -->
              <td class="align-middle">
                <div class="contact-info">
                  <div class="phone">
                    <i class="fa fa-phone mr-1 text-primary"></i>
                    <a href="tel:{{ booking.clientPhone }}" class="text-decoration-none text-dark">
                      {{ booking.clientPhone }}
                    </a>
                  </div>
                  <div *ngIf="booking.clientMobile" class="mobile mt-1">
                    <i class="fa fa-mobile mr-1 text-info"></i>
                    <small>{{ booking.clientMobile }}</small>
                  </div>
                </div>
              </td>
              
              <!-- ุนุฏุฏ ุงูุถููู -->
              <td class="align-middle">
                <span class="badge badge-light border">
                  <i class="fa fa-users mr-1"></i>
                  {{ booking.guestsCount }}
                </span>
              </td>
              
              <!-- ุงูุชุงุฑูุฎ -->
              <td class="align-middle">
                <div class="date-info">
                  <div class="date-badge">
                    {{ booking.bookingDate | date:'yyyy/MM/dd' }}
                  </div>
                  <div class="day-name text-muted small">
                    {{ getArabicDay(booking.bookingDate) }}
                  </div>
                </div>
              </td>
              
              <!-- ุงูููุช -->
              <td class="align-middle">
                <span class="badge badge-light border">
                  {{ formatTime(booking.bookingTime) }}
                </span>
              </td>
              
              <!-- ุงูููุงู -->
              <td class="align-middle">
                <span class="venue-info">
                  <i class="fa fa-map-marker mr-1 text-danger"></i>
                  {{ getVenueName(booking.venueId) }}
                </span>
              </td>
              
              <!-- ุงูููุน -->
              <td class="align-middle">
                <span class="badge badge-pill" [ngClass]="getBookingTypeClass(booking.bookingType)">
                  {{ getBookingTypeText(booking.bookingType) }}
                </span>
              </td>
              
              <!-- ุงูุญุงูุฉ -->
              <td class="align-middle">
                <span class="badge badge-pill" [ngClass]="getStatusClass(booking.bookingStatus)">
                  <i *ngIf="booking.bookingStatus === BookingStatus.Cancelled" class="fa fa-times-circle mr-1"></i>
                  <i *ngIf="booking.bookingStatus === BookingStatus.Completed" class="fa fa-flag-checkered mr-1"></i>
                  <i *ngIf="booking.bookingStatus === BookingStatus.Postponed" class="fa fa-calendar-alt mr-1"></i>
                  <i *ngIf="booking.bookingStatus === BookingStatus.Pending" class="fa fa-clock-o mr-1"></i>
                  {{ getStatusText(booking.bookingStatus) }}
                </span>
              </td>
              
              <!-- ุงููุจูุบ -->
              <td class="align-middle">
                <div class="amount-info">
                  <div class="total-amount text-success font-weight-bold">
                    {{ booking.totalAmount | currency:'EGP':'symbol':'1.0-0' }}
                  </div>
                  <div *ngIf="booking.depositAmount > 0" class="deposit-amount">
                    <small class="text-primary">
                      <i class="fa fa-money mr-1"></i>
                      {{ booking.depositAmount | currency:'EGP':'symbol':'1.0-0' }}
                    </small>
                  </div>
                </div>
              </td>
              
              <!-- ุฒุฑ ุงูุทุจุงุนุฉ -->
              <td class="align-middle text-center">
               <button class="btn btn-sm btn-print-receipt"
        (click)="printCustomerReceipt(booking.bookingId!)"
        title="ุทุจุงุนุฉ ูุงุชูุฑุฉ ุงูุนููู">
  ๐งพ ุทุจุงุนุฉ
</button>
              </td>
              
              <!-- ุงูุฅุฌุฑุงุกุงุช -->
              <td class="align-middle text-center" *ngIf="booking.bookingStatus !== 3">
                <div class="actions-wrapper">
                  <!-- ุฒุฑ ุงูุซูุงุซ ููุงุท -->
                  <button class="menu-trigger-btn"
                          (click)="toggleActionsMenu(booking.bookingId, $event)">
                    <i class="fa fa-ellipsis-v"></i>
                  </button>

                  <!-- ุงููุงุฆูุฉ -->
                  <div class="actions-popup"
                       *ngIf="openedMenuId === booking.bookingId"
                       (click)="$event.stopPropagation()">
                    <button class="action-btn edit-btn"
                            (click)="editBooking(booking.bookingId); closeMenu()">
                      <i class="fa fa-pencil"></i>
                      ุชุนุฏูู ุงูุญุฌุฒ
                    </button>

                    <button *ngIf="booking.bookingStatus === 0"
                            class="action-btn confirm-btn"
                            (click)="confirmBooking(booking); closeMenu()">
                      <i class="fa fa-check-circle"></i>
                      ุชุฃููุฏ ุงูุญุฌุฒ
                    </button>
                    
                    <button *ngIf="booking.bookingStatus === 0 || booking.bookingStatus === 1"
                            class="action-btn postpone-btn"
                            (click)="postponeBooking(booking); closeMenu()">
                      <i class="fa fa-calendar"></i>
                      ุชุฃุฌูู ุงูุญุฌุฒ
                    </button>

                    <button *ngIf="booking.bookingStatus === 0 || booking.bookingStatus === 1"
                            class="action-btn cancel-btn"
                            (click)="cancelBooking(booking); closeMenu()">
                      <i class="fa fa-times-circle"></i>
                      ุฅูุบุงุก ุงูุญุฌุฒ
                    </button>
                  </div>
                </div>
              </td>
            </tr>
            
            <!-- ุญุงูุฉ ุนุฏู ูุฌูุฏ ุจูุงูุงุช -->
            <tr *ngIf="filteredBookings.length === 0 && !loading">
              <td colspan="12" class="text-center py-5">
                <div class="empty-state">
                  <i class="fa fa-calendar-times fa-3x text-muted mb-3"></i>
                  <h5 class="text-muted">ูุง ุชูุฌุฏ ุญุฌูุฒุงุช</h5>
                  <p class="text-muted mb-4">ูู ูุชู ุงูุนุซูุฑ ุนูู ุญุฌูุฒุงุช ูุทุงุจูุฉ ููุจุญุซ</p>
                  <button class="btn btn-primary btn-sm" (click)="createBooking()">
                    <i class="fa fa-plus mr-2"></i>
                    ุฅูุดุงุก ุฃูู ุญุฌุฒ
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Pagination Footer -->
    <div *ngIf="filteredBookings.length > 0 && !loading" class="card-footer bg-light">
      <div class="d-flex justify-content-between align-items-center">
        <!-- ุนุฏุฏ ุงูุนูุงุตุฑ ูู ุงูุตูุญุฉ -->
        <div class="pagination-info">
          <div class="form-inline">
            <label for="itemsPerPage" class="mr-2">ุนุฑุถ</label>
            <select id="itemsPerPage" 
                    class="form-control form-control-sm" 
                    [(ngModel)]="itemsPerPage" 
                    (change)="onItemsPerPageChange()"
                    style="width: 70px;">
              <option value="5">5</option>
              <option value="10">10</option>
              <option value="20">20</option>
              <option value="50">50</option>
            </select>
            <span class="ml-2">ุนูุงุตุฑ ูู ุงูุตูุญุฉ</span>
          </div>
        </div>
        
        <!-- ุฃุฑูุงู ุงูุตูุญุงุช -->
        <div class="pagination-controls">
          <nav>
            <ul class="pagination pagination-sm mb-0">
              <!-- ุฒุฑ ุงูุตูุญุฉ ุงูุณุงุจูุฉ -->
              <li class="page-item" [class.disabled]="currentPage === 1">
                <a class="page-link" href="javascript:void(0)" (click)="previousPage()">
                  <i class="fa fa-chevron-right"></i>
                </a>
              </li>
              
              <!-- ุฃุฑูุงู ุงูุตูุญุงุช -->
              <li class="page-item" *ngFor="let page of pages" 
                  [class.active]="page === currentPage">
                <a class="page-link" href="javascript:void(0)" (click)="goToPage(page)">
                  {{ page }}
                </a>
              </li>
              
              <!-- ุฒุฑ ุงูุตูุญุฉ ุงูุชุงููุฉ -->
              <li class="page-item" [class.disabled]="currentPage === totalPages">
                <a class="page-link" href="javascript:void(0)" (click)="nextPage()">
                  <i class="fa fa-chevron-left"></i>
                </a>
              </li>
            </ul>
          </nav>
        </div>
        
        <!-- ูุนูููุงุช ุงูุตูุญุฉ ุงูุญุงููุฉ -->
        <div class="pagination-stats">
          <span class="text-muted">
            ุงูุตูุญุฉ {{ currentPage }} ูู {{ totalPages }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>